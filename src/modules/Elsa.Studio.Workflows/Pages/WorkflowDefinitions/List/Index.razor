@page "/workflows/definitions"
@using Variant = MudBlazor.Variant
@using Elsa.Api.Client.Resources.WorkflowDefinitions.Models
@using Size = MudBlazor.Size

<PageTitle>Workflow definitions</PageTitle>

<MudContainer MaxWidth="MaxWidth.False">
    <PageHeading Text="Workflow definitions"/>

    <MudTable
        ServerData="@(new Func<TableState, Task<TableData<WorkflowDefinitionRow>>>(ServerReload))"
        Dense="false" Hover="true" @ref="_table" Elevation="0" T="WorkflowDefinitionRow" OnRowClick="@OnRowClick" RowStyle="cursor: pointer;"
        MultiSelection="true" @bind-SelectedItems="@_selectedRows">
        <ToolBarContent>
            <MudMenu EndIcon="@Icons.Material.Filled.KeyboardArrowDown" Label="Bulk actions" Color="Color.Default" Variant="Variant.Filled">
                <MudMenuItem OnClick="OnBulkDeleteClicked">Delete</MudMenuItem>
                <MudMenuItem>Publish</MudMenuItem>
                <MudMenuItem>Unpublish</MudMenuItem>
            </MudMenu>
            <MudSpacer/>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="@OnCreateWorkflowClicked">Create workflow</MudButton>
        </ToolBarContent>
        <HeaderContent>
            <MudTh>
                <MudTableSortLabel SortLabel="ID" T="WorkflowDefinitionSummary">ID</MudTableSortLabel>
            </MudTh>
            <MudTh>
                <MudTableSortLabel SortLabel="Name" T="WorkflowDefinitionSummary">Name</MudTableSortLabel>
            </MudTh>
            <MudTh Style="text-align:right">
                <MudTableSortLabel SortLabel="LatestVersion" T="WorkflowDefinitionSummary" Style="text-align: right;">Latest version</MudTableSortLabel>
            </MudTh>
            <MudTh Style="text-align:right">
                <MudTableSortLabel SortLabel="PublishedVersion" T="WorkflowDefinitionSummary" Style="text-align: right;">Published version</MudTableSortLabel>
            </MudTh>
            <MudTh>
                Description
            </MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="ID">@context.DefinitionId</MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Latest version" Style="text-align:right">@context.LatestVersion</MudTd>
            <MudTd DataLabel="Published version" Style="text-align:right">@(context.PublishedVersion?.ToString() ?? "-")</MudTd>
            <MudTd DataLabel="Description">@context.Description</MudTd>
            <MudTd DataLabel="" Style="text-align:right">
                <MudStack Row="true" Spacing="3">
                    <a href="#" @onclick="@(() => OnEditClicked(context.DefinitionId))" @onclick:preventDefault="true" @onclick:stopPropagation="true">
                        <MudIcon Icon="@Icons.TwoTone.Edit" Color="Color.Primary" Size="Size.Medium" />
                    </a>
                    <a href="#" @onclick="@(async () => await OnDeleteClicked(context))" @onclick:preventDefault="true" @onclick:stopPropagation="true">
                        <MudIcon Icon="@Icons.TwoTone.Delete" Color="Color.Warning" Size="Size.Medium"/>
                    </a>
                </MudStack>
            </MudTd>
        </RowTemplate>
        <NoRecordsContent>
            <MudText>No workflow definitions found</MudText>
        </NoRecordsContent>
        <LoadingContent>
            <MudText>Loading...</MudText>
        </LoadingContent>
        <PagerContent>
            <MudTablePager/>
        </PagerContent>
    </MudTable>
</MudContainer>

<CreateWorkflowDialog/>